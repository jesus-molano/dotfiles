# --- CATPPUCCIN MOCHA THEME ---
source = ~/.config/hypr/mocha.conf

################
### MONITORS ###
################
# --- MONITOR ---
monitor = desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97, 1920x1080@74.97, 1920x0, 1
monitor = desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52, 1920x1080@74.97, 0x0, 1
monitor = , preferred, auto, 1  # Fallback for hot-plugged monitors

# --- ENV VARS (CR√çTICO PARA NVIDIA) ---
env = LIBVA_DRIVER_NAME,nvidia
env = XDG_SESSION_TYPE,wayland
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = NVD_BACKEND,direct
env = ELECTRON_OZONE_PLATFORM_HINT,auto
env = ENABLE_VKBASALT,1

# --- CURSOR THEME ---
# XCURSOR_* = XWayland apps | HYPRCURSOR_* = native Hyprland
env = XCURSOR_THEME,catppuccin-mocha-dark-cursors
env = XCURSOR_SIZE,24
env = HYPRCURSOR_THEME,catppuccin-mocha-dark-cursors
env = HYPRCURSOR_SIZE,24

# --- QT THEMING ---
env = QT_QPA_PLATFORMTHEME,qt6ct

# --- AUTOSTART ---
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user start hyprpolkitagent
exec-once = waybar & swww-daemon & swaync
exec-once = sleep 1 && swww img $HOME/Pictures/wallhaven-ogy6zm_1920x1080.png
exec-once = ~/.config/hypr/scripts/reactive-rgb.sh &
exec-once = clipse -listen
exec-once = hypridle
exec-once = hyprsunset -t 4500
exec-once = hyprpm reload -n
exec-once = ~/.config/hypr/scripts/wait-monitor.sh

# Boot: browser on left (WS1), terminal on right (WS5)
exec-once = [workspace 1 silent] google-chrome-stable
exec-once = [workspace 5 silent] ghostty

# --- INPUT ---
input {
    kb_layout = us,es
    follow_mouse = 1
    sensitivity = 0
    repeat_rate = 50
    repeat_delay = 300
}

# --- GENERAL ---
general {
    gaps_in = 4
    gaps_out = 8
    border_size = 2
    col.active_border = $mauve $blue 45deg
    col.inactive_border = $surface0
    layout = dwindle
    allow_tearing = true
}

decoration {
    rounding = 10
    blur {
        enabled = true
        size = 5
        passes = 2
        ignore_opacity = true
    }
}

animations {
    enabled = true
    bezier = md3_decel, 0.05, 0.7, 0.1, 1
    animation = windows, 1, 3, md3_decel, popin 60%
    animation = fade, 1, 3, md3_decel
    animation = border, 1, 5, md3_decel
    animation = borderangle, 1, 30, md3_decel, loop
    animation = workspaces, 1, 3, md3_decel, slide
}

dwindle {
    pseudotile = true
    preserve_split = true
}

misc {
    disable_hyprland_logo = true
    force_default_wallpaper = 0
    vfr = true
    on_focus_under_fullscreen = 2
}

xwayland {
    force_zero_scaling = true
}

binds {
    allow_workspace_cycles = true
}

# --- VARIABLES ---
$mainMod = ALT
$hyper = CTRL ALT SUPER SHIFT

# --- BINDS ---
# Cambio de idioma: SUPER + SPACE
bind = SUPER, SPACE, exec, hyprctl switchxkblayout all next && notify-send -t 1500 -h string:x-canonical-private-synchronous:kbd "Û∞åå $(hyprctl devices -j | jq -r '[.keyboards[] | select(.main)][0].active_keymap')"

# Apps
bind = $mainMod, SPACE, exec, ~/.config/rofi/launchers/type-1/launcher.sh
bind = $hyper, RETURN, exec, ghostty || kitty
bind = $hyper, B, exec, google-chrome-stable
bind = $hyper, E, exec, thunar
bind = $hyper, C, exec, ~/.config/hypr/scripts/raise-or-run.sh jetbrains-webstorm webstorm
bind = $hyper, N, exec, swaync-client -t -sw
bind = $hyper, S, exec, ~/.config/hypr/scripts/raise-or-run.sh Slack slack
bind = $hyper, P, exec, hyprshot -m region
bind = $hyper, M, exec, ~/.config/hypr/scripts/raise-or-run.sh com.github.th_ch.youtube_music youtube-music
bind = $hyper, G, exec, ~/.config/hypr/scripts/raise-or-run.sh steam steam
bind = $hyper, D, exec, ~/.config/hypr/scripts/raise-or-run.sh discord discord
bind = $hyper, F, exec, ~/.config/hypr/scripts/gaming-mode.sh
bind = $hyper, 1, exec, ~/.config/hypr/scripts/raise-or-run.sh 1password 1password
bind = $hyper, L, exec, hyprlock
bind = $hyper, Q, exec, ~/.config/rofi/powermenu/type-2/powermenu.sh
bind = $hyper, slash, exec, ~/.config/hypr/scripts/keybinds.sh
bind = $hyper, period, exec, ~/.config/hypr/scripts/claude-skills.sh
bind = $hyper, comma, exec, ~/.config/hypr/scripts/nvim-keys.sh
bind = $hyper, T, exec, ~/.config/hypr/scripts/translate.sh
bind = $mainMod, T, exec, ~/.config/hypr/scripts/translate.sh clipboard

# Window Management (VIM HJKL)
bind = $mainMod, X, killactive
bind = $mainMod, h, movefocus, l
bind = $mainMod, l, movefocus, r
bind = $mainMod, k, movefocus, u
bind = $mainMod, j, movefocus, d


# Resize
binde = $mainMod CTRL, l, resizeactive, 40 0
binde = $mainMod CTRL, h, resizeactive, -40 0
binde = $mainMod CTRL, k, resizeactive, 0 -40
binde = $mainMod CTRL, j, resizeactive, 0 40

# Mouse bindings
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Workspaces ‚Äî left monitor (ALT + Q/W/E/R)
bind = $mainMod, Q, workspace, 1
bind = $mainMod, W, workspace, 2
bind = $mainMod, E, workspace, 3
bind = $mainMod, R, workspace, 4

# Workspaces ‚Äî right monitor (ALT + U/I/O/P)
bind = $mainMod, U, workspace, 5
bind = $mainMod, I, workspace, 6
bind = $mainMod, O, workspace, 7
bind = $mainMod, P, workspace, 8

# Move window silently ‚Äî left (ALT+SHIFT + Q/W/E/R)
bind = $mainMod SHIFT, Q, movetoworkspacesilent, 1
bind = $mainMod SHIFT, W, movetoworkspacesilent, 2
bind = $mainMod SHIFT, E, movetoworkspacesilent, 3
bind = $mainMod SHIFT, R, movetoworkspacesilent, 4

# Move window silently ‚Äî right (ALT+SHIFT + U/I/O/P)
bind = $mainMod SHIFT, U, movetoworkspacesilent, 5
bind = $mainMod SHIFT, I, movetoworkspacesilent, 6
bind = $mainMod SHIFT, O, movetoworkspacesilent, 7
bind = $mainMod SHIFT, P, movetoworkspacesilent, 8

# Swap active workspaces between monitors
bind = $mainMod, S, swapactiveworkspaces, desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52 desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97

# Back and forth (√∫ltimo workspace visitado)
bind = $mainMod, TAB, hyprexpo:expo, toggle

# --- WORKSPACE RULES (monitor assignment) ---
# Left monitor (C52): WS 1-4 ‚Äî browsing, multimedia, chat
workspace = 1, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52, default:true
workspace = 2, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52
workspace = 3, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52
workspace = 4, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000C52
# Right monitor (B97): WS 5-8 ‚Äî terminal, code, work
workspace = 5, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97, default:true
workspace = 6, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97
workspace = 7, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97
workspace = 8, monitor:desc:Philips Consumer Electronics Company PHL 273V7 0x00000B97

bind = $mainMod, M, fullscreen
bind = $mainMod, F, togglefloating
bind = $mainMod, C, exec, ~/.config/hypr/scripts/super-copy.sh
bind = $mainMod, V, exec, ~/.config/hypr/scripts/super-paste.sh
bind = $mainMod SHIFT, V, exec, ghostty --title=clipse --class=clipse -e clipse
bind = $mainMod, A, exec, ~/.config/hypr/scripts/audio-toggle.sh

# --- MEDIA & VOLUME ---
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindl = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPrev, exec, playerctl previous

# --- Scratchpad ---
bind = $mainMod, grave, togglespecialworkspace, scratchpad
bind = $mainMod SHIFT, grave, movetoworkspace, special:scratchpad

# --- Group/Tab bindings ---
bind = $mainMod, G, togglegroup
bind = $mainMod, N, changegroupactive, f
bind = $mainMod SHIFT, N, changegroupactive, b
bind = $mainMod SHIFT, h, movewindoworgroup, l
bind = $mainMod SHIFT, l, movewindoworgroup, r
bind = $mainMod SHIFT, k, movewindoworgroup, u
bind = $mainMod SHIFT, j, movewindoworgroup, d

# --- üé® COLOR PICKER ---
bind = $hyper, K, exec, hyprpicker -a

# --- üéÆ GAMING (Baja Latencia) ---
windowrule {
    name = gaming-cs2
    match:class = ^(cs2)$
    immediate = on
    fullscreen = on
    no_blur = on
    opaque = on
}

windowrule {
    name = gaming-steam-apps
    match:class = ^(steam_app_\d+)$
    immediate = on
    no_blur = on
    opaque = on
}

windowrule {
    name = gaming-gamescope
    match:class = ^(.gamescope-wrapped)$
    immediate = on
    no_blur = on
    opaque = on
}

windowrule = float on, match:title ^(Friends List)$
windowrule = suppress_event activate activatefocus, match:class ^(steam)$

# --- üéà FLOTANTES ---
windowrule = float on, match:class ^(pavucontrol)$
windowrule = float on, match:class ^(swappy)$
windowrule = float on, match:class ^(hyprpolkitagent)$

windowrule {
    name = coolercontrol
    match:class = ^(org.coolercontrol.CoolerControl)$
    float = on
    size = 1100 700
    center = on
}

windowrule {
    name = openrgb
    match:class = ^(openrgb)$
    float = on
    size = 1000 650
    center = on
}

# --- üß† JETBRAINS (WebStorm) ---
windowrule {
    name = webstorm-splash
    match:class = ^(jetbrains-webstorm)$
    match:title = ^(splash)$
    float = on
    center = on
}

windowrule {
    name = webstorm-popups
    match:class = ^(jetbrains-webstorm)$
    match:title = ^(win\d+)$
    no_anim = on
}

windowrule = center on, match:class ^(jetbrains-webstorm)$, match:float 1

# --- üñºÔ∏è PICTURE-IN-PICTURE ---
windowrule {
    name = pip
    match:title = ^(Picture-in-Picture)$
    float = on
    pin = on
    move = (monitor_w-window_w-10) (monitor_h-window_h-10)
}

# --- Scratchpad ---
windowrule {
    name = scratchpad
    match:workspace = special:scratchpad
    float = on
    size = 60% 60%
    center = on
}

# --- AUTO-ASSIGN: pinned apps ---
# Left monitor ‚Äî multimedia & chat
windowrule = workspace 2 silent, match:class ^(com\.github\.th_ch\.youtube_music)$
windowrule = workspace 3 silent, match:class ^(Slack)$
windowrule = workspace 3 silent, match:class ^(discord)$

# Right monitor ‚Äî work
windowrule = workspace 6 silent, match:class ^(jetbrains-webstorm)$
windowrule = workspace 8 silent, match:class ^(steam)$

# --- LAYER RULES ---
layerrule = blur on, match:namespace waybar
layerrule = ignore_alpha 0.3, match:namespace waybar

# --- CLIPSE FLOATING ---
windowrule {
    name = clipse
    match:title = ^(clipse)$
    float = on
    size = 622 652
    center = on
}

# --- PLUGINS ---
plugin {
    hyprexpo {
        columns = 3
        gap_size = 5
        bg_col = $base
        workspace_method = center current
    }

    dynamic-cursors {
        enabled = true
        mode = tilt
        threshold = 2

        tilt {
            limit = 5000
            function = negative_quadratic
        }

        shake {
            enabled = true
            threshold = 6.0
            speed = 4.0
            timeout = 2000
        }
    }

    hyprfocus {
        enabled = true
        animate_floating = true
        animate_workspacechange = true
        focus_animation = shrink

        bezier = realsmooth, 0.28, 0.29, 0.69, 1.04

        shrink {
            shrink_percentage = 0.95
            in_bezier = realsmooth
            in_speed = 1
            out_bezier = realsmooth
            out_speed = 2
        }
    }

    # hyprtrails {
    #     color = $mauve
    # }
}
